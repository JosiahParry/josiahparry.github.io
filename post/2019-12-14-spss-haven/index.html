<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 3.1.1">
  <meta name="generator" content="Hugo 0.52" />
  <meta name="author" content="Josiah Parry">

  
  
  
  
    
  
  <meta name="description" content="My education as a social scientist‚Äîundergratuate studies in sociology and anthropology‚Äîwas largely focused on theory and the application of theory to social problems. For the most part, I taught myself how to apply those methods through R. I was fortunate enough to have avoided ever using SPSS. Perhaps that is good. Perhaps it is not. The use of R in the social sciences is increasing and I will go as far as to say that that is great news.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2019-12-14-spss-haven/">

  


  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  
  <link rel="stylesheet" href="/css/cv.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-90934606-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Josiah Parry">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Josiah Parry">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2019-12-14-spss-haven/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="Josiah Parry">
  <meta property="og:url" content="/post/2019-12-14-spss-haven/">
  <meta property="og:title" content="Finding an SPSS {haven} | Josiah Parry">
  <meta property="og:description" content="My education as a social scientist‚Äîundergratuate studies in sociology and anthropology‚Äîwas largely focused on theory and the application of theory to social problems. For the most part, I taught myself how to apply those methods through R. I was fortunate enough to have avoided ever using SPSS. Perhaps that is good. Perhaps it is not. The use of R in the social sciences is increasing and I will go as far as to say that that is great news."><meta property="og:image" content="/img/img/bubbles.jpg">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-12-14T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-12-14T00:00:00&#43;00:00">
  

  

  

  <title>Finding an SPSS {haven} | Josiah Parry</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Josiah Parry</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        

        <li class="nav-item">
          <a class="nav-link" href="/">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/post/">
            
            <span>Blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>About</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

      

        

        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Finding an SPSS {haven}</h1>

  
  <p class="page-subtitle">SPSS gripes, Tolstoy, a bit of advanced R, and some resolutions</p>
  

  
    

<div class="article-metadata">

  
  
  <span itemscope itemprop="author" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Josiah Parry">
  </span>
  

  <span class="article-date">
    
    <meta content="2019-12-14 00:00:00 &#43;0000 UTC" itemprop="datePublished">
    <time datetime="2019-12-14 00:00:00 &#43;0000 UTC" itemprop="dateModified">
      Dec 14, 2019
    </time>
  </span>
  <span itemscope itemprop="publisher" itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Josiah Parry">
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    15 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="/categories/r/">R</a>, 
    
    <a href="/categories/tutorial/">tutorial</a>
    
  </span>
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Finding%20an%20SPSS%20%7bhaven%7d&amp;url=%2fpost%2f2019-12-14-spss-haven%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2019-12-14-spss-haven%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2019-12-14-spss-haven%2f&amp;title=Finding%20an%20SPSS%20%7bhaven%7d"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2019-12-14-spss-haven%2f&amp;title=Finding%20an%20SPSS%20%7bhaven%7d"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Finding%20an%20SPSS%20%7bhaven%7d&amp;body=%2fpost%2f2019-12-14-spss-haven%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    















  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<p>My education as a social scientist‚Äîundergratuate studies in sociology and anthropology‚Äîwas largely focused on theory and the application of theory to social problems. For the most part, I taught myself how to apply those methods through R. I was fortunate enough to have avoided ever using SPSS. Perhaps that is good. Perhaps it is not. The use of R in the social sciences is increasing and I will go as far as to say that that is great news. However, there are still holdouts.</p>
<p>Very recently I came across data exported from SPSS in the wild. In the work that I get to engage in at the Boston Area Research Initiative (<a href="https://www.northeastern.edu/csshresearch/bostonarearesearchinitiative/">BARI</a>) we receive data from various sources, whether these be municipal organizations, the police department, or non-profits, and as Tolstoy said:</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
‚ÄúAll clean datasets are alike; every messy dataset is messy in its own way.‚Äù, Leo Tolstoy. <a href="https://t.co/Z70eXgKRaK">https://t.co/Z70eXgKRaK</a>
</p>
‚Äî Maria Khalusova (<span class="citation">@mariaKhalusova</span>) <a href="https://twitter.com/mariaKhalusova/status/1204853611743842304?ref_src=twsrc%5Etfw">December 11, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>In this post I want to illustrate two of the main pain points I encountered while working with data from SPSS.I also go rather deep into the weeds about R data structures and how we can manipulate them. While this is ‚Äúabout‚Äù SPSS data, folks looking for a better understanding of R object may benefit from this as well (specifically Gripe 2).</p>
<div id="haven" class="section level2">
<h2>{haven}</h2>
<p>I am not sure where the inspiration for the name ‚Äúhaven‚Äù came from. But I am sure that its name does indeed speak for itself. haven enables R programmers that are SPSS‚ÄîStata and SAS as well‚Äîilliterate to work with data that is not naturally intended for R use. There are two key behaviors of SPSS data that I was unaware of and that plagued me. I break these down into three gripes below.</p>
</div>
<div id="gripes" class="section level2">
<h2>Gripes</h2>
<p>I maintain three gripes about SPSS data.</p>
<ol style="list-style-type: decimal">
<li>Factor values are represented numerically and the values that they represent are stored in metadata.</li>
<li>Column names are vague. The values they represent are stored as a label (metadata).</li>
<li>Missing values can be represented innumerably. Each column can have user defined missing values, i.e. <code>9999</code>.</li>
</ol>
<p>Now, I must say that I have found it best practice to try and combat my own gripes.</p>
<p>In regards to the former two gripes, this is not unheard of behavior nor is it rare. Associating numeric values with <em>related</em> values‚Äîoh, I don‚Äôt know‚Ä¶think of a user ID and an email address‚Äîis in essence the core of relational database systems (RDBMS). One may even have the gall to argue that RDBMS power many of the tools I use and take for granted. I would most likely be willing to concede that point.</p>
<p>The third gripe can be quite easily countered if I am to be frank. Missing data is in of itself data. An <code>NA</code> is an <code>NA</code> is an <code>NA</code> may not be a generalizable statement. Providing values such as <code>9999</code> in place of a missing value in some cases may be a relic of antiquity where missingness could not be handled by software. Or, perhaps we can frame missingness other ways. Let‚Äôs imagine we are conducting a study and we want to keep track of why there was missing data. This could have been from a non-response, or a withdrawal, or erroneously entered data, or any other number of reasons. Keeping a record of that missing data may useful.</p>
<div id="gripe-1-numbers-representing-characters-or-labels" class="section level3">
<h3>Gripe 1: numbers representing characters (or labels)</h3>
<p>Sometimes I really would like <code>stringsAsFactors = TRUE</code>. Working with survey data tends to be one of those times. R has a robust method of creating, handling, and manipulating factors<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and because of this, we aren‚Äôt required to numerically encode our data. This may be a personal preference, but I really like to be reminded of <em>what</em> I am working with and seeing the factor levels clearly spelled out for me is quite nice.</p>
<p>Since the data I am working with at BARI is confidential, I‚Äôve found some SPSS data hosted by the <a href="https://www.bath.ac.uk/">University of Bath</a><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> to illustrate this with.</p>
<p>Reading in data is rather straightforward. SPSS data come with a <code>.sav</code> file extension. Following standard <a href="https://readr.tidyverse.org/"><code>readr</code></a> convention we can read a .sav file with <code>haven::read_sav()</code>.</p>
<p><em>Note: the syntax above is used for referencing an exported function from a namespace (package name). The syntax is <code>pkgname::function()</code>.</em></p>
<p>The below line reads in the sav file from the University of Bath.</p>
<p><em>Note: by wrapping an object assignment expression, such as the below, in parentheses the object is then printed (I just recently figured this out).</em></p>
<pre class="r"><code>library(haven)
library(tidyverse)</code></pre>
<pre><code>## ‚îÄ‚îÄ Attaching packages ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse 1.2.1 ‚îÄ‚îÄ</code></pre>
<pre><code>## ‚úî ggplot2 3.2.1     ‚úî purrr   0.3.2
## ‚úî tibble  2.1.3     ‚úî dplyr   0.8.3
## ‚úî tidyr   1.0.0     ‚úî stringr 1.4.0
## ‚úî readr   1.2.1     ‚úî forcats 0.3.0</code></pre>
<pre><code>## ‚îÄ‚îÄ Conflicts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ tidyverse_conflicts() ‚îÄ‚îÄ
## ‚úñ dplyr::filter() masks stats::filter()
## ‚úñ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code># read in sav file
(noise &lt;- haven::read_sav(&quot;http://staff.bath.ac.uk/pssiw/stats2/noisedata.sav&quot;))</code></pre>
<pre><code>## # A tibble: 20 x 6
##    SUBJECT GENDER     NONE   LOW MEDIUM  HIGH
##      &lt;dbl&gt; &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1       1 1            46    55     68    44
##  2       2 1            44    61     72    51
##  3       3 1            51    59     79    38
##  4       4 1            34    45     51    37
##  5       5 1            55    58     45    45
##  6       6 1            29    64     74    39
##  7       7 1            34    60     79    46
##  8       8 1            44    57     66    51
##  9       9 1            50    61     59    40
## 10      10 1            41    63     68    50
## 11      11 2            46    58     72    47
## 12      12 2            47    55     74    55
## 13      13 2            38    44     70    46
## 14      14 2            38    47     61    53
## 15      15 2            50    20     58    51
## 16      16 2            46    51     74    42
## 17      17 2            44    54     78    46
## 18      18 2            38    48     69    51
## 19      19 2            40    50     70    47
## 20      20 2            46    52     66    41</code></pre>
<p>The above shows <code>GENDER</code> codes as a numeric value. But if you print out the tibble to your console you will see labels. So in this case, where there is a <code>1</code> under <code>GENDER</code>, the printed console shows <code>[male]</code>, and the same is true for <code>2</code> and <code>[female]</code>. We can get a sense of this by viewing the structure of the tibble.</p>
<pre class="r"><code>str(noise)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    20 obs. of  6 variables:
##  $ SUBJECT: num  1 2 3 4 5 6 7 8 9 10 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ GENDER : &#39;haven_labelled&#39; num  1 1 1 1 1 1 1 1 1 1 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##   ..- attr(*, &quot;labels&quot;)= Named num  1 2
##   .. ..- attr(*, &quot;names&quot;)= chr  &quot;male&quot; &quot;female&quot;
##  $ NONE   : num  46 44 51 34 55 29 34 44 50 41 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ LOW    : num  55 61 59 45 58 64 60 57 61 63 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ MEDIUM : num  68 72 79 51 45 74 79 66 59 68 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ HIGH   : num  44 51 38 37 45 39 46 51 40 50 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;</code></pre>
<p>Above we can see that <code>GENDER</code> has an attribute <code>labels</code> which is a named numeric vector. The unique values are 1 and 2 representing ‚Äúmale‚Äù and ‚Äúfemale‚Äù respectively. I struggle to keep this mental association. I‚Äôd prefer to have this shown explicitly. Fortunately, haven provides the function <code>haven::as_factor()</code> which will convert these pesky integer columns to their respective factor values. We just need to pass the data frame as the only argument‚Äîsure, there are other arguments if you want to get fancy.</p>
<pre class="r"><code># selecting just 2 columns and 2 rows for simlicity.
small_lil_df &lt;- slice(noise, 1, 20) %&gt;% 
  select(1, 2)

# convert coded response to response text
haven::as_factor(small_lil_df)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   SUBJECT GENDER
##     &lt;dbl&gt; &lt;fct&gt; 
## 1       1 male  
## 2      20 female</code></pre>
<p>And now we can just forget those integers ever existed in the firstplace!</p>
</div>
<div id="gripe-2-uninformative-column-names" class="section level3">
<h3>Gripe 2: uninformative column names</h3>
<p>There are three key rules to <a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a>.</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>Each variable forms a column. Got it. So this means that any thing that can help describe our observation should be a column. Say we have a table of survey respondents. In this case each row should be a respondent and each column should be a variable (or feature, or predictor, or x, or whatever) associate with that respondent. This could be something like age, birth date, or the respondents response to a survey question.</p>
<p>In the <a href="https://style.tidyverse.org/index.html">tidyverse style guide</a> Hadley Wickham writes</p>
<blockquote>
<p>Generally, variable names should be nouns and function names should be verbs. Strive for names that are concise and meaningful (this is not easy!).</p>
</blockquote>
<p>I personaly try to extend this to column names as well. Feature names are important so I, as a researcher, can remember what is what. From my encounters with SPSS data, I‚Äôve found that feature names can be rather uninformative e.g. ‚ÄúQ12.‚Äù Much like factors, columns may have associated information hidden somewhere within them.</p>
<p>We read in the personality data set from the Universit of Bath below.</p>
<pre class="r"><code># read in sav file with column labels
personality &lt;- haven::read_sav(&quot;http://staff.bath.ac.uk/pssiw/stats2/personality.sav&quot;)
select(personality, 1:10)</code></pre>
<pre><code>## # A tibble: 459 x 10
##    PERS01 PERS02 PERS03 PERS04 PERS05 PERS06 PERS07 PERS08 PERS09 PERS10
##     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1      5      4      5      1      4      3      3      1      2      3
##  2      1      1      5      2      1      2      5      1      5      1
##  3      4      1      5      3      3      4      5      3      1      4
##  4      4      2      5      1      4      3      4      4      4      5
##  5      2      3      5      1      2      4      5      2      3      3
##  6      1      1      5      4      3      4      4      2      1      4
##  7      3      2      5      1      2      1      1      2      5      4
##  8      5      2      4      2      4      1      4      3      3      5
##  9      5      1      4      3      2      1      4      4      2      3
## 10      4      1      5      1      4      3      4      1      5      4
## # ‚Ä¶ with 449 more rows</code></pre>
<p>The first thing that I notice is rather apalling: each <em>column</em> represents a <em>person</em>. oof, untidy. But this issue isn‚Äôt what brought me to these data. If you print the data to the console, you see something similar as what is above. If you <em>view</em> (<code>View(df)</code>) the data, the story is different. There is associated information underneath each column header.</p>
<pre class="r"><code>str(personality[,1:5])</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    459 obs. of  5 variables:
##  $ PERS01: num  5 1 4 4 2 1 3 5 5 4 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;talkative&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS02: num  4 1 1 2 3 1 2 2 1 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;finds fault&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS03: num  5 5 5 5 5 5 5 4 4 5 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;does a thorough job&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS04: num  1 2 3 1 1 4 1 2 3 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;depressed&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS05: num  4 1 3 4 2 3 2 4 2 4 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;original&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;</code></pre>
<p>Yikes. These labels seem to be character judgements! Whatever the labels represent, I want them, and I want them as the column headers.</p>
<p>From looking at the structure of the data frame we can glean that each column has a label.</p>
<p><strong>Warning</strong>: I‚Äôm going to walk through a fair bit of the theory and under the hood work to make these labels column names. Scroll to the bottom of this section to find the function definition.</p>
<div id="aside-r-theory" class="section level4">
<h4>Aside: R theory:</h4>
<ul>
<li>Each column of a data frame is actually just a vector. Each vector can have it‚Äôs own attributes (as above).</li>
<li>A data frame is actually just a list of equal length vectors (same number of observations).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></li>
<li>‚ÄúAll objects can have arbitrary additional attributes, used to store metadata about the object.‚Äù<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></li>
<li>We can fetch list elements using <code>[[</code> notation, e.g. <code>my_list[[1]]</code>
<ul>
<li><code>purrr::pluck()</code> is an alternative to using <code>[[</code> for grabbing the underlying elements inside of a data structure. This means we can use <code>pluck(my_list, 1)</code> in place of <code>my_list[[1]]</code></li>
</ul></li>
</ul>
<p>Okay, but <em>how</em> does one actually get the label from the vector? The first step is to actually grab the vector. Below I use <code>purrr::pluck()</code>to pull the first column. Note that <code>slice()</code> is used for grabing specific row indexes. The below code is equivalent to <code>personality[1:10,][[1]]</code>. I prefer using the purrr functions because they are more legible.</p>
<pre class="r"><code>col_1 &lt;- slice(personality, 1:10) %&gt;% 
  pluck(1)</code></pre>
<p>We can access all of the vectors attributes with, you guessed it, the <code>attributes()</code> function.</p>
<pre class="r"><code>attributes(col_1)</code></pre>
<pre><code>## $label
## [1] &quot;talkative&quot;
## 
## $format.spss
## [1] &quot;F1.0&quot;</code></pre>
<p>This returns a named list. We can access (or set) specific attributes using the <code>attr()</code> function. The two arguments we must supply are <code>x</code>, the object, and <code>which</code>, which attribute we seek. In this case the values are <code>col_1</code> and <code>label</code> respectively.</p>
<pre class="r"><code>attr(col_1, &quot;label&quot;)</code></pre>
<pre><code>## [1] &quot;talkative&quot;</code></pre>
<p>purrr yet again makes working with list objects easy. purrr exports a function factory<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> called <code>purrr::attr_getter()</code>. This function generates a function which accesses specific attributes. We can create a function <code>get_label()</code> using <code>attr_getter()</code> all we have to do is tell it <em>which</em> attribute we would like.</p>
<pre class="r"><code># generate a get_label f(x) via purr
get_label &lt;- purrr::attr_getter(&quot;label&quot;)

get_label(col_1)</code></pre>
<pre><code>## [1] &quot;talkative&quot;</code></pre>
<p>Well, lovely. Let‚Äôs just use this on our <code>personality</code> data frame.</p>
<pre class="r"><code>get_label(personality)</code></pre>
<pre><code>## NULL</code></pre>
<p>Ope. Welp. That didn‚Äôt work. We should just give up ü§∑.</p>
<p><img src="https://media.giphy.com/media/O5xChSjqUIxsk/giphy.gif" /></p>
<p>The reason this didn‚Äôt work is because we tried to use <code>get_label()</code> on a tibble which didn‚Äôt have the ‚Äúlabel‚Äù attribute. We can verify this by looking at the list names of the attributes of <code>personality</code>.</p>
<pre class="r"><code>names(attributes(personality))</code></pre>
<pre><code>## [1] &quot;names&quot;     &quot;row.names&quot; &quot;class&quot;</code></pre>
<p>But what about the attribtues of each column? We can iterate over each column using <code>map()</code> to look at the attributes. Below I iterate over the first five columns. More on <code>map()</code><a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>.</p>
<pre class="r"><code>map(select(personality, 1:5), ~names(attributes(.)))</code></pre>
<pre><code>## $PERS01
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS02
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS03
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS04
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS05
## [1] &quot;label&quot;       &quot;format.spss&quot;</code></pre>
<p>Well, now that we‚Äôve iterated over the columns and illustrated that the attributes live there, why not iterate over the columns and use <code>get_label()</code>?</p>
<pre class="r"><code># use get_label to retrieve column labels
map_chr(select(personality, 1:5), get_label)</code></pre>
<pre><code>##                PERS01                PERS02                PERS03 
##           &quot;talkative&quot;         &quot;finds fault&quot; &quot;does a thorough job&quot; 
##                PERS04                PERS05 
##           &quot;depressed&quot;            &quot;original&quot;</code></pre>
<p>Again, yikes @ the labels. Let‚Äôs store these results into a vector so we can rename the original columns.</p>
<pre class="r"><code>pers_labels &lt;- map_chr(personality, get_label)</code></pre>
<p>We can now change the names using <code>setNames()</code> from base R. We will then make the column headers tidy (personal definition of tidy column names) using <code>janitor::clean_names()</code>.</p>
<pre class="r"><code>setNames(personality, pers_labels) %&gt;% 
  janitor::clean_names() %&gt;% 
  select(1:5)</code></pre>
<pre><code>## # A tibble: 459 x 5
##    talkative finds_fault does_a_thorough_job depressed original
##        &lt;dbl&gt;       &lt;dbl&gt;               &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1         5           4                   5         1        4
##  2         1           1                   5         2        1
##  3         4           1                   5         3        3
##  4         4           2                   5         1        4
##  5         2           3                   5         1        2
##  6         1           1                   5         4        3
##  7         3           2                   5         1        2
##  8         5           2                   4         2        4
##  9         5           1                   4         3        2
## 10         4           1                   5         1        4
## # ‚Ä¶ with 449 more rows</code></pre>
<p>In the case that a column doesn‚Äôt have a label, <code>get_label()</code> will return <code>NULL</code> and then <code>setNames()</code> will fail. To work around this, you can use the name of the column rather than the label value. Below is a function definition which handles this for you and, optionally, lets you specify which columns to rename based on a regex pattern. I think we‚Äôve done enough list manipulation for the day. If you have questions about the function definition I‚Äôd be happy to work through it one on one with you via twitter DMs.</p>
<pre class="r"><code>label_to_colname &lt;- function(df, pattern) {
  get_label &lt;- purrr::attr_getter(&quot;label&quot;)
  col_labels &lt;- purrr::map(df, get_label)

  col_labels[unlist(map(col_labels, is.null))]  &lt;- names(col_labels[unlist(purrr::map(col_labels, is.null))])

  if (missing(pattern)) {
    names_to_replace &lt;- rep(TRUE, ncol(df))
  } else {
    names_to_replace &lt;- stringr::str_detect(names(col_labels), pattern)
  }
  
  colnames(df)[names_to_replace] &lt;- janitor::make_clean_names(unlist(col_labels[names_to_replace]))

  haven::zap_label(df)
}

label_to_colname(personality) %&gt;% 
  select(1:5)</code></pre>
<pre><code>## # A tibble: 459 x 5
##    talkative finds_fault does_a_thorough_job depressed original
##        &lt;dbl&gt;       &lt;dbl&gt;               &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1         5           4                   5         1        4
##  2         1           1                   5         2        1
##  3         4           1                   5         3        3
##  4         4           2                   5         1        4
##  5         2           3                   5         1        2
##  6         1           1                   5         4        3
##  7         3           2                   5         1        2
##  8         5           2                   4         2        4
##  9         5           1                   4         3        2
## 10         4           1                   5         1        4
## # ‚Ä¶ with 449 more rows</code></pre>
<pre class="r"><code># heh.
label_to_colname(personality, &quot;PERS37&quot;) %&gt;% 
  select(37)</code></pre>
<pre><code>## # A tibble: 459 x 1
##    sometimes_rude
##             &lt;dbl&gt;
##  1              4
##  2              1
##  3              3
##  4              3
##  5              5
##  6              1
##  7              2
##  8              2
##  9              1
## 10              1
## # ‚Ä¶ with 449 more rows</code></pre>
</div>
</div>
<div id="gripe-3-user-defined-missing-values" class="section level3">
<h3>Gripe 3: user defined missing values</h3>
<p>I‚Äôll keep this one short. If there are user defined missing values in a <code>.sav</code> file, you can encode these as <code>NA</code> by setting the <code>user_na</code> arugment to <code>TRUE</code>.</p>
<pre class="r"><code># there aren&#39;t any missing values but you get the idea
noise &lt;- haven::read_sav(&quot;http://staff.bath.ac.uk/pssiw/stats2/noisedata.sav&quot;,
                         user_na = TRUE)</code></pre>
<p>And if for any reason that did not suffice, you can replace missing values with <code>replace_na()</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
</div>
</div>
<div id="take-aways" class="section level2">
<h2>Take aways</h2>
<ul>
<li>All data is messy in it‚Äôs own way.</li>
<li><code>haven::read_sav()</code> will read SPSS data.</li>
<li><code>haven::as_factor()</code> will apply column labels in place of the numeric values (if present).<br />
</li>
<li>Replace user defined NA values by setting <code>user_na = TRUE</code> i.e. <code>haven::read_sav(&quot;filepath.sav&quot;, user_na = TRUE)</code></li>
<li>All R objects can have attributes.</li>
<li>You can access attributes using <code>attributes()</code> or <code>attr()</code>.</li>
<li>Data frames are made of vectors.</li>
<li>Data frames are actually just lists masquerading as rectangles.</li>
</ul>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Check out <a href="https://forcats.tidyverse.org/">forcats</a> for working with factors.<a href="#fnref1" class="footnote-back">‚Ü©</a></p></li>
<li id="fn2"><p>Anthony Horowitz wrote a rather fun murder mystery novel titled <a href="https://www.amazon.com/Magpie-Murders-Novel-Anthony-Horowitz/dp/0062645226">Magpie Murders</a> which takes place in a small town outside of Bath. I recommend it.<a href="#fnref2" class="footnote-back">‚Ü©</a></p></li>
<li id="fn3"><p><a href="http://adv-r.had.co.nz/Data-structures.html#data-frames" class="uri">http://adv-r.had.co.nz/Data-structures.html#data-frames</a><a href="#fnref3" class="footnote-back">‚Ü©</a></p></li>
<li id="fn4"><p><a href="http://adv-r.had.co.nz/Data-structures.html#attributes" class="uri">http://adv-r.had.co.nz/Data-structures.html#attributes</a><a href="#fnref4" class="footnote-back">‚Ü©</a></p></li>
<li id="fn5"><p>A function factory is an object which creates other function objects.<a href="#fnref5" class="footnote-back">‚Ü©</a></p></li>
<li id="fn6"><p><a href="https://adv-r.hadley.nz/functionals.html#map" class="uri">https://adv-r.hadley.nz/functionals.html#map</a><a href="#fnref6" class="footnote-back">‚Ü©</a></p></li>
<li id="fn7"><p><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="uri">https://tidyr.tidyverse.org/reference/replace_na.html</a><a href="#fnref7" class="footnote-back">‚Ü©</a></p></li>
</ol>
</div>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/r/">R</a>
  
  <a class="badge badge-light" href="/tags/spss/">spss</a>
  
  <a class="badge badge-light" href="/tags/dplyr/">dplyr</a>
  
  <a class="badge badge-light" href="/tags/tidyverse/">tidyverse</a>
  
  <a class="badge badge-light" href="/tags/purrr/">purrr</a>
  
  <a class="badge badge-light" href="/tags/advanced-r/">advanced R</a>
  
  <a class="badge badge-light" href="/tags/r-theory/">R theory</a>
  
</div>



    






<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  <img class="portrait mr-3" src="/img/portrait.jpg" itemprop="image" alt="Avatar">
  
  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/">Josiah Parry</a></h5>
    <h6 class="card-subtitle">Social Data Scientist</h6>
    
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//twitter.com/josiahparry" >
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//github.com/josiahparry" >
          <i class="fab fa-github"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="//linkedin.com/in/josiahparry" >
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
      <li>
        <a itemprop="sameAs" href="mailto:josiah.parry@yahoo.com" >
          <i class="fas fa-envelope"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>




    
    
    <div class="article-widget">
      <div class="hr-light"></div>
      <h3>Related</h3>
      <ul>
        
        <li><a href="/post/2019-08-09-epa-waterquality/">Water Quality Analysis</a></li>
        
        <li><a href="/post/read-chunked-csv/">Reading Multiple csvs as 1 data frame</a></li>
        
        <li><a href="/post/write-chunked-csv/">Chunking your csv</a></li>
        
        <li><a href="/post/tidy-coursera-r-programming/">Coursera R-Programming: Week 2 Problems</a></li>
        
        <li><a href="/project/geniusr/">{genius}</a></li>
        
      </ul>
    </div>
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  

  <p class="powered-by">
    &copy; 2019 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/R.min.js"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    

    
    

    
    

    
    
    
    
    
    
    
    
    <script src="/js/academic.min.74b0d3361475b08c40cf31120e82937b.js"></script>

    

  </body>
</html>

