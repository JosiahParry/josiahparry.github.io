<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Josiah Parry</title>
    
    
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="/css/main.min.d3bf53b36f3c9a16e5cdae3b1e9f6320cf7e1833357c47d8a780ef4d7069c3bc.css"/>

    
    
    

    
    
 
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WZD2QXY3QW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZD2QXY3QW');
</script>
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">Josiah Parry</a>
    </div>
      
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/atelier-estuary-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<a rel="me" href="https://fosstodon.org/@josiahparry"></a>
<a rel="me" href="https://mapstodon.space/@josiah"></a>

</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="/about/">about</a>
  
    <a class="color-link nav-link" href="/">posts</a>
  
    <a class="color-link nav-link" href="/projects/">projects</a>
  
    <a class="color-link nav-link" href="/tags/">tags</a>
  
    <a class="color-link nav-link" href="/archives/">archives</a>
  
  <a class="color-link nav-link" href="/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="https://twitter.com/@josiahparry" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://linkedin.com/in/josiahparry" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://medium.com/@JosiahParry/" target="_blank" rel="noopener" title="Medium">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,2 L26,2 L26,26 L2,26 L2,2 Z M7.72727142,10.0265545 L7.72727142,17.1527156 C7.77112416,17.4097828 7.69008764,17.6723786 7.50898513,17.8600642 L5.81538462,19.9143852 L5.81538462,20.1852847 L10.617683,20.1852847 L10.617683,19.9143852 L8.92408245,17.8600642 C8.74165168,17.6726892 8.65559727,17.4118239 8.69074193,17.1527156 L8.69074193,10.9897526 L12.9059255,20.1852847 L13.3951878,20.1852847 L17.0157294,10.9897526 L17.0157294,18.3190884 C17.0157294,18.514738 17.0157294,18.5523628 16.8877685,18.6802876 L15.5855778,19.9444852 L15.5855778,20.2153846 L21.9083531,20.2153846 L21.9083531,19.9444852 L20.6513252,18.7103876 C20.5403599,18.6258033 20.4853154,18.4867833 20.50831,18.3491883 L20.50831,9.28158097 C20.4853154,9.14398599 20.5403599,9.00496587 20.6513252,8.92038167 L21.9384615,7.68628409 L21.9384615,7.41538462 L17.4824105,7.41538462 L14.3059685,15.3391941 L10.6929541,7.41538462 L6.01861668,7.41538462 L6.01861668,7.68628409 L7.52403936,9.49980554 C7.67182769,9.63301305 7.74730311,9.82863473 7.72727142,10.0265545 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/josiahparry" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    
</div>




 
	
	<script src="/js/main.min.c1aee25a817e9beb1f9c4afd9d62311227a7f5e46720e404dc1dda97281f47f2.js" integrity="sha256-wa7iWoF+m+sfnEr9nWIxEien9eRnIOQE3B3alygfR/I="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        

<h1 class="post-title">Finding an SPSS {haven}</h1>
    
    <time>December 14, 2019</time>
    
    <div>
        <p>
        


<p>My education as a social scientist—undergratuate studies in sociology and anthropology—was largely focused on theory and the application of theory to social problems. For the most part, I taught myself how to apply those methods through R. I was fortunate enough to have avoided ever using SPSS. Perhaps that is good. Perhaps it is not. The use of R in the social sciences is increasing and I will go as far as to say that that is great news. However, there are still holdouts.</p>
<p>Very recently I came across data exported from SPSS in the wild. In the work that I get to engage in at the Boston Area Research Initiative (<a href="https://www.northeastern.edu/csshresearch/bostonarearesearchinitiative/">BARI</a>) we receive data from various sources, whether these be municipal organizations, the police department, or non-profits, and as Tolstoy said:</p>
<blockquote class="twitter-tweet">
<p lang="en" dir="ltr">
“All clean datasets are alike; every messy dataset is messy in its own way.”, Leo Tolstoy. <a href="https://t.co/Z70eXgKRaK">https://t.co/Z70eXgKRaK</a>
</p>
— Maria Khalusova (<span class="citation">@mariaKhalusova</span>) <a href="https://twitter.com/mariaKhalusova/status/1204853611743842304?ref_src=twsrc%5Etfw">December 11, 2019</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>In this post I want to illustrate two of the main pain points I encountered while working with data from SPSS.I also go rather deep into the weeds about R data structures and how we can manipulate them. While this is “about” SPSS data, folks looking for a better understanding of R object may benefit from this as well (specifically Gripe 2).</p>
<div id="haven" class="section level2">
<h2>{haven}</h2>
<p>I am not sure where the inspiration for the name “haven” came from. But I am sure that its name does indeed speak for itself. haven enables R programmers that are SPSS—Stata and SAS as well—illiterate to work with data that is not naturally intended for R use. There are two key behaviors of SPSS data that I was unaware of and that plagued me. I break these down into three gripes below.</p>
</div>
<div id="gripes" class="section level2">
<h2>Gripes</h2>
<p>I maintain three gripes about SPSS data.</p>
<ol style="list-style-type: decimal">
<li>Factor values are represented numerically and the values that they represent are stored in metadata.</li>
<li>Column names are vague. The values they represent are stored as a label (metadata).</li>
<li>Missing values can be represented innumerably. Each column can have user defined missing values, i.e. <code>9999</code>.</li>
</ol>
<p>Now, I must say that I have found it best practice to try and combat my own gripes.</p>
<p>In regards to the former two gripes, this is not unheard of behavior nor is it rare. Associating numeric values with <em>related</em> values—oh, I don’t know…think of a user ID and an email address—is in essence the core of relational database systems (RDBMS). One may even have the gall to argue that RDBMS power many of the tools I use and take for granted. I would most likely be willing to concede that point.</p>
<p>The third gripe can be quite easily countered if I am to be frank. Missing data is in of itself data. An <code>NA</code> is an <code>NA</code> is an <code>NA</code> may not be a generalizable statement. Providing values such as <code>9999</code> in place of a missing value in some cases may be a relic of antiquity where missingness could not be handled by software. Or, perhaps we can frame missingness other ways. Let’s imagine we are conducting a study and we want to keep track of why there was missing data. This could have been from a non-response, or a withdrawal, or erroneously entered data, or any other number of reasons. Keeping a record of that missing data may useful.</p>
<div id="gripe-1-numbers-representing-characters-or-labels" class="section level3">
<h3>Gripe 1: numbers representing characters (or labels)</h3>
<p>Sometimes I really would like <code>stringsAsFactors = TRUE</code>. Working with survey data tends to be one of those times. R has a robust method of creating, handling, and manipulating factors<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> and because of this, we aren’t required to numerically encode our data. This may be a personal preference, but I really like to be reminded of <em>what</em> I am working with and seeing the factor levels clearly spelled out for me is quite nice.</p>
<p>Since the data I am working with at BARI is confidential, I’ve found some SPSS data hosted by the <a href="https://www.bath.ac.uk/">University of Bath</a><a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> to illustrate this with.</p>
<p>Reading in data is rather straightforward. SPSS data come with a <code>.sav</code> file extension. Following standard <a href="https://readr.tidyverse.org/"><code>readr</code></a> convention we can read a .sav file with <code>haven::read_sav()</code>.</p>
<p><em>Note: the syntax above is used for referencing an exported function from a namespace (package name). The syntax is <code>pkgname::function()</code>.</em></p>
<p>The below line reads in the sav file from the University of Bath.</p>
<p><em>Note: by wrapping an object assignment expression, such as the below, in parentheses the object is then printed (I just recently figured this out).</em></p>
<pre class="r"><code>library(haven)

# read in sav file
(noise &lt;- haven::read_sav(&quot;http://staff.bath.ac.uk/pssiw/stats2/noisedata.sav&quot;))</code></pre>
<pre><code>## # A tibble: 20 x 6
##    SUBJECT     GENDER  NONE   LOW MEDIUM  HIGH
##      &lt;dbl&gt;  &lt;dbl+lbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1       1 1 [male]      46    55     68    44
##  2       2 1 [male]      44    61     72    51
##  3       3 1 [male]      51    59     79    38
##  4       4 1 [male]      34    45     51    37
##  5       5 1 [male]      55    58     45    45
##  6       6 1 [male]      29    64     74    39
##  7       7 1 [male]      34    60     79    46
##  8       8 1 [male]      44    57     66    51
##  9       9 1 [male]      50    61     59    40
## 10      10 1 [male]      41    63     68    50
## 11      11 2 [female]    46    58     72    47
## 12      12 2 [female]    47    55     74    55
## 13      13 2 [female]    38    44     70    46
## 14      14 2 [female]    38    47     61    53
## 15      15 2 [female]    50    20     58    51
## 16      16 2 [female]    46    51     74    42
## 17      17 2 [female]    44    54     78    46
## 18      18 2 [female]    38    48     69    51
## 19      19 2 [female]    40    50     70    47
## 20      20 2 [female]    46    52     66    41</code></pre>
<p>The above shows <code>GENDER</code> codes as a numeric value. But if you print out the tibble to your console you will see labels. So in this case, where there is a <code>1</code> under <code>GENDER</code>, the printed console shows <code>[male]</code>, and the same is true for <code>2</code> and <code>[female]</code>. We can get a sense of this by viewing the structure of the tibble.</p>
<pre class="r"><code>str(noise)</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    20 obs. of  6 variables:
##  $ SUBJECT: num  1 2 3 4 5 6 7 8 9 10 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ GENDER : &#39;haven_labelled&#39; num  1 1 1 1 1 1 1 1 1 1 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##   ..- attr(*, &quot;labels&quot;)= Named num  1 2
##   .. ..- attr(*, &quot;names&quot;)= chr  &quot;male&quot; &quot;female&quot;
##  $ NONE   : num  46 44 51 34 55 29 34 44 50 41 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ LOW    : num  55 61 59 45 58 64 60 57 61 63 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ MEDIUM : num  68 72 79 51 45 74 79 66 59 68 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;
##  $ HIGH   : num  44 51 38 37 45 39 46 51 40 50 ...
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F8.2&quot;</code></pre>
<p>Above we can see that <code>GENDER</code> has an attribute <code>labels</code> which is a named numeric vector. The unique values are 1 and 2 representing “male” and “female” respectively. I struggle to keep this mental association. I’d prefer to have this shown explicitly. Fortunately, haven provides the function <code>haven::as_factor()</code> which will convert these pesky integer columns to their respective factor values. We just need to pass the data frame as the only argument—sure, there are other arguments if you want to get fancy.</p>
<pre class="r"><code># selecting just 2 columns and 2 rows for simlicity.
small_lil_df &lt;- slice(noise, 1, 20) %&gt;% 
  select(1, 2)

# convert coded response to response text
haven::as_factor(small_lil_df)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   SUBJECT GENDER
##     &lt;dbl&gt; &lt;fct&gt; 
## 1       1 male  
## 2      20 female</code></pre>
<p>And now we can just forget those integers ever existed in the firstplace!</p>
</div>
<div id="gripe-2-uninformative-column-names" class="section level3">
<h3>Gripe 2: uninformative column names</h3>
<p>There are three key rules to <a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a>.</p>
<ol style="list-style-type: decimal">
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>Each variable forms a column. Got it. So this means that any thing that can help describe our observation should be a column. Say we have a table of survey respondents. In this case each row should be a respondent and each column should be a variable (or feature, or predictor, or x, or whatever) associate with that respondent. This could be something like age, birth date, or the respondents response to a survey question.</p>
<p>In the <a href="https://style.tidyverse.org/index.html">tidyverse style guide</a> Hadley Wickham writes</p>
<blockquote>
<p>Generally, variable names should be nouns and function names should be verbs. Strive for names that are concise and meaningful (this is not easy!).</p>
</blockquote>
<p>I personaly try to extend this to column names as well. Feature names are important so I, as a researcher, can remember what is what. From my encounters with SPSS data, I’ve found that feature names can be rather uninformative e.g. “Q12.” Much like factors, columns may have associated information hidden somewhere within them.</p>
<p>We read in the personality data set from the Universit of Bath below.</p>
<pre class="r"><code># read in sav file with column labels
(personality &lt;- haven::read_sav(&quot;http://staff.bath.ac.uk/pssiw/stats2/personality.sav&quot;))</code></pre>
<pre><code>## # A tibble: 459 x 44
##    PERS01 PERS02 PERS03 PERS04 PERS05 PERS06 PERS07 PERS08 PERS09 PERS10
##     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
##  1      5      4      5      1      4      3      3      1      2      3
##  2      1      1      5      2      1      2      5      1      5      1
##  3      4      1      5      3      3      4      5      3      1      4
##  4      4      2      5      1      4      3      4      4      4      5
##  5      2      3      5      1      2      4      5      2      3      3
##  6      1      1      5      4      3      4      4      2      1      4
##  7      3      2      5      1      2      1      1      2      5      4
##  8      5      2      4      2      4      1      4      3      3      5
##  9      5      1      4      3      2      1      4      4      2      3
## 10      4      1      5      1      4      3      4      1      5      4
## # … with 449 more rows, and 34 more variables: PERS11 &lt;dbl&gt;, PERS12 &lt;dbl&gt;,
## #   PERS13 &lt;dbl&gt;, PERS14 &lt;dbl&gt;, PERS15 &lt;dbl&gt;, PERS16 &lt;dbl&gt;, PERS17 &lt;dbl&gt;,
## #   PERS18 &lt;dbl&gt;, PERS19 &lt;dbl&gt;, PERS20 &lt;dbl&gt;, PERS21 &lt;dbl&gt;, PERS22 &lt;dbl&gt;,
## #   PERS23 &lt;dbl&gt;, PERS24 &lt;dbl&gt;, PERS25 &lt;dbl&gt;, PERS26 &lt;dbl&gt;, PERS27 &lt;dbl&gt;,
## #   PERS28 &lt;dbl&gt;, PERS29 &lt;dbl&gt;, PERS30 &lt;dbl&gt;, PERS31 &lt;dbl&gt;, PERS32 &lt;dbl&gt;,
## #   PERS33 &lt;dbl&gt;, PERS34 &lt;dbl&gt;, PERS35 &lt;dbl&gt;, PES36 &lt;dbl&gt;, PERS37 &lt;dbl&gt;,
## #   PERS38 &lt;dbl&gt;, PERS39 &lt;dbl&gt;, PERS40 &lt;dbl&gt;, PERS41 &lt;dbl&gt;, PERS42 &lt;dbl&gt;,
## #   PERS43 &lt;dbl&gt;, PERS44 &lt;dbl&gt;</code></pre>
<p>The first thing that I notice is rather apalling: each <em>column</em> represents a <em>person</em>. oof, untidy. But this issue isn’t what brought me to these data. If you print the data to the console, you see something similar as what is above. If you <em>view</em> (<code>View(df)</code>) the data, the story is different. There is associated information underneath each column header.</p>
<pre class="r"><code>str(personality[,1:5])</code></pre>
<pre><code>## Classes &#39;tbl_df&#39;, &#39;tbl&#39; and &#39;data.frame&#39;:    459 obs. of  5 variables:
##  $ PERS01: num  5 1 4 4 2 1 3 5 5 4 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;talkative&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS02: num  4 1 1 2 3 1 2 2 1 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;finds fault&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS03: num  5 5 5 5 5 5 5 4 4 5 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;does a thorough job&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS04: num  1 2 3 1 1 4 1 2 3 1 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;depressed&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;
##  $ PERS05: num  4 1 3 4 2 3 2 4 2 4 ...
##   ..- attr(*, &quot;label&quot;)= chr &quot;original&quot;
##   ..- attr(*, &quot;format.spss&quot;)= chr &quot;F1.0&quot;</code></pre>
<p>Yikes. These labels seem to be character judgements! Whatever the labels represent, I want them, and I want them as the column headers.</p>
<p>From looking at the structure of the data frame we can glean that each column has a label.</p>
<p><strong>Warning</strong>: I’m going to walk through a fair bit of the theory and under the hood work to make these labels column names. Scroll to the bottom of this section to find the function definition.</p>
<div id="aside-r-theory" class="section level4">
<h4>Aside: R theory:</h4>
<ul>
<li>Each column of a data frame is actually just a vector. Each vector can have it’s own attributes (as above).</li>
<li>A data frame is actually just a list of equal length vectors (same number of observations).<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></li>
<li>“All objects can have arbitrary additional attributes, used to store metadata about the object.”<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></li>
<li>We can fetch list elements using <code>[[</code> notation, e.g. <code>my_list[[1]]</code>
<ul>
<li><code>purrr::pluck()</code> is an alternative to using <code>[[</code> for grabbing the underlying elements inside of a data structure. This means we can use <code>pluck(my_list, 1)</code> in place of <code>my_list[[1]]</code></li>
</ul></li>
</ul>
<p>Okay, but <em>how</em> does one actually get the label from the vector? The first step is to actually grab the vector. Below I use <code>purrr::pluck()</code>to pull the first column. Note that <code>slice()</code> is used for grabing specific row indexes. The below code is equivalent to <code>personality[1:10,][[1]]</code>. I prefer using the purrr functions because they are more legible.</p>
<pre class="r"><code>col_1 &lt;- slice(personality, 1:10) %&gt;% 
  pluck(1)</code></pre>
<p>We can access all of the vectors attributes with, you guessed it, the <code>attributes()</code> function.</p>
<pre class="r"><code>attributes(col_1)</code></pre>
<pre><code>## $label
## [1] &quot;talkative&quot;
## 
## $format.spss
## [1] &quot;F1.0&quot;</code></pre>
<p>This returns a named list. We can access (or set) specific attributes using the <code>attr()</code> function. The two arguments we must supply are <code>x</code>, the object, and <code>which</code>, which attribute we seek. In this case the values are <code>col_1</code> and <code>label</code> respectively.</p>
<pre class="r"><code>attr(col_1, &quot;label&quot;)</code></pre>
<pre><code>## [1] &quot;talkative&quot;</code></pre>
<p>purrr yet again makes working with list objects easy. purrr exports a function factory<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a> called <code>purrr::attr_getter()</code>. This function generates a function which accesses specific attributes. We can create a function <code>get_label()</code> using <code>attr_getter()</code> all we have to do is tell it <em>which</em> attribute we would like.</p>
<pre class="r"><code># generate a get_label f(x) via purr
get_label &lt;- purrr::attr_getter(&quot;label&quot;)

get_label(col_1)</code></pre>
<pre><code>## [1] &quot;talkative&quot;</code></pre>
<p>Well, lovely. Let’s just use this on our <code>personality</code> data frame.</p>
<pre class="r"><code>get_label(personality)</code></pre>
<pre><code>## NULL</code></pre>
<p>Ope. Welp. That didn’t work. We should just give up 🤷.</p>
<p><img src="https://media.giphy.com/media/O5xChSjqUIxsk/giphy.gif" /></p>
<p>The reason this didn’t work is because we tried to use <code>get_label()</code> on a tibble which didn’t have the “label” attribute. We can verify this by looking at the list names of the attributes of <code>personality</code>.</p>
<pre class="r"><code>names(attributes(personality))</code></pre>
<pre><code>## [1] &quot;names&quot;     &quot;row.names&quot; &quot;class&quot;</code></pre>
<p>But what about the attribtues of each column? We can iterate over each column using <code>map()</code> to look at the attributes. Below I iterate over the first five columns. More on <code>map()</code><a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>.</p>
<pre class="r"><code>map(select(personality, 1:5), ~names(attributes(.)))</code></pre>
<pre><code>## $PERS01
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS02
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS03
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS04
## [1] &quot;label&quot;       &quot;format.spss&quot;
## 
## $PERS05
## [1] &quot;label&quot;       &quot;format.spss&quot;</code></pre>
<p>Well, now that we’ve iterated over the columns and illustrated that the attributes live there, why not iterate over the columns and use <code>get_label()</code>?</p>
<pre class="r"><code># use get_label to retrieve column labels
map_chr(select(personality, 1:5), get_label)</code></pre>
<pre><code>##                PERS01                PERS02                PERS03 
##           &quot;talkative&quot;         &quot;finds fault&quot; &quot;does a thorough job&quot; 
##                PERS04                PERS05 
##           &quot;depressed&quot;            &quot;original&quot;</code></pre>
<p>Again, yikes @ the labels. Let’s store these results into a vector so we can rename the original columns.</p>
<pre class="r"><code>pers_labels &lt;- map_chr(personality, get_label)</code></pre>
<p>We can now change the names using <code>setNames()</code> from base R. We will then make the column headers tidy (personal definition of tidy column names) using <code>janitor::clean_names()</code>.</p>
<pre class="r"><code>setNames(personality, pers_labels) %&gt;% 
  janitor::clean_names() %&gt;% 
  select(1:5)</code></pre>
<pre><code>## # A tibble: 459 x 5
##    talkative finds_fault does_a_thorough_job depressed original
##        &lt;dbl&gt;       &lt;dbl&gt;               &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1         5           4                   5         1        4
##  2         1           1                   5         2        1
##  3         4           1                   5         3        3
##  4         4           2                   5         1        4
##  5         2           3                   5         1        2
##  6         1           1                   5         4        3
##  7         3           2                   5         1        2
##  8         5           2                   4         2        4
##  9         5           1                   4         3        2
## 10         4           1                   5         1        4
## # … with 449 more rows</code></pre>
<p>In the case that a column doesn’t have a label, <code>get_label()</code> will return <code>NULL</code> and then <code>setNames()</code> will fail. To work around this, you can use the name of the column rather than the label value. Below is a function definition which handles this for you and, optionally, lets you specify which columns to rename based on a regex pattern. I think we’ve done enough list manipulation for the day. If you have questions about the function definition I’d be happy to work through it one on one with you via twitter DMs.</p>
<pre class="r"><code>label_to_colname &lt;- function(df, pattern) {
  get_label &lt;- purrr::attr_getter(&quot;label&quot;)
  col_labels &lt;- purrr::map(df, get_label)

  col_labels[unlist(map(col_labels, is.null))]  &lt;- names(col_labels[unlist(purrr::map(col_labels, is.null))])

  if (missing(pattern)) {
    names_to_replace &lt;- rep(TRUE, ncol(df))
  } else {
    names_to_replace &lt;- stringr::str_detect(names(col_labels), pattern)
  }
  
  colnames(df)[names_to_replace] &lt;- janitor::make_clean_names(unlist(col_labels[names_to_replace]))

  haven::zap_label(df)
}

label_to_colname(personality) %&gt;% 
  select(1:5)</code></pre>
<pre><code>## # A tibble: 459 x 5
##    talkative finds_fault does_a_thorough_job depressed original
##        &lt;dbl&gt;       &lt;dbl&gt;               &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1         5           4                   5         1        4
##  2         1           1                   5         2        1
##  3         4           1                   5         3        3
##  4         4           2                   5         1        4
##  5         2           3                   5         1        2
##  6         1           1                   5         4        3
##  7         3           2                   5         1        2
##  8         5           2                   4         2        4
##  9         5           1                   4         3        2
## 10         4           1                   5         1        4
## # … with 449 more rows</code></pre>
<pre class="r"><code># heh.
label_to_colname(personality, &quot;PERS37&quot;) %&gt;% 
  select(37)</code></pre>
<pre><code>## # A tibble: 459 x 1
##    sometimes_rude
##             &lt;dbl&gt;
##  1              4
##  2              1
##  3              3
##  4              3
##  5              5
##  6              1
##  7              2
##  8              2
##  9              1
## 10              1
## # … with 449 more rows</code></pre>
</div>
</div>
<div id="gripe-3-user-defined-missing-values" class="section level3">
<h3>Gripe 3: user defined missing values</h3>
<p>I’ll keep this one short. If there are user defined missing values in a <code>.sav</code> file, you can encode these as <code>NA</code> by setting the <code>user_na</code> arugment to <code>TRUE</code>.</p>
<pre class="r"><code># there aren&#39;t any missing values but you get the idea
noise &lt;- haven::read_sav(&quot;http://staff.bath.ac.uk/pssiw/stats2/noisedata.sav&quot;,
                         user_na = TRUE)</code></pre>
<p>And if for any reason that did not suffice, you can replace missing values with <code>replace_na()</code><a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a>.</p>
</div>
</div>
<div id="take-aways" class="section level2">
<h2>Take aways</h2>
<ul>
<li>All data is messy in it’s own way.</li>
<li><code>haven::read_sav()</code> will read SPSS data.</li>
<li><code>haven::as_factor()</code> will apply column labels in place of the numeric values (if present).<br />
</li>
<li>Replace user defined NA values by setting <code>user_na = TRUE</code> i.e. <code>haven::read_sav(&quot;filepath.sav&quot;, user_na = TRUE)</code></li>
<li>All R objects can have attributes.</li>
<li>You can access attributes using <code>attributes()</code> or <code>attr()</code>.</li>
<li>Data frames are made of vectors.</li>
<li>Data frames are actually just lists masquerading as rectangles.</li>
</ul>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Check out <a href="https://forcats.tidyverse.org/">forcats</a> for working with factors.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Anthony Horowitz wrote a rather fun murder mystery novel titled <a href="https://www.amazon.com/Magpie-Murders-Novel-Anthony-Horowitz/dp/0062645226">Magpie Murders</a> which takes place in a small town outside of bath. I recommend it.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p><a href="http://adv-r.had.co.nz/Data-structures.html#data-frames" class="uri">http://adv-r.had.co.nz/Data-structures.html#data-frames</a><a href="#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p><a href="http://adv-r.had.co.nz/Data-structures.html#attributes" class="uri">http://adv-r.had.co.nz/Data-structures.html#attributes</a><a href="#fnref4" class="footnote-back">↩</a></p></li>
<li id="fn5"><p>A function factory is an object which creates other function objects.<a href="#fnref5" class="footnote-back">↩</a></p></li>
<li id="fn6"><p><a href="https://adv-r.hadley.nz/functionals.html#map" class="uri">https://adv-r.hadley.nz/functionals.html#map</a><a href="#fnref6" class="footnote-back">↩</a></p></li>
<li id="fn7"><p><a href="https://tidyr.tidyverse.org/reference/replace_na.html" class="uri">https://tidyr.tidyverse.org/reference/replace_na.html</a><a href="#fnref7" class="footnote-back">↩</a></p></li>
</ol>
</div>

        </p>
    </div>
    
    

    

    <div class="page-footer">
        
    </div>
    



        




<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="https://twitter.com/@josiahparry" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://linkedin.com/in/josiahparry" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://medium.com/@JosiahParry/" target="_blank" rel="noopener" title="Medium">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,2 L26,2 L26,26 L2,26 L2,2 Z M7.72727142,10.0265545 L7.72727142,17.1527156 C7.77112416,17.4097828 7.69008764,17.6723786 7.50898513,17.8600642 L5.81538462,19.9143852 L5.81538462,20.1852847 L10.617683,20.1852847 L10.617683,19.9143852 L8.92408245,17.8600642 C8.74165168,17.6726892 8.65559727,17.4118239 8.69074193,17.1527156 L8.69074193,10.9897526 L12.9059255,20.1852847 L13.3951878,20.1852847 L17.0157294,10.9897526 L17.0157294,18.3190884 C17.0157294,18.514738 17.0157294,18.5523628 16.8877685,18.6802876 L15.5855778,19.9444852 L15.5855778,20.2153846 L21.9083531,20.2153846 L21.9083531,19.9444852 L20.6513252,18.7103876 C20.5403599,18.6258033 20.4853154,18.4867833 20.50831,18.3491883 L20.50831,9.28158097 C20.4853154,9.14398599 20.5403599,9.00496587 20.6513252,8.92038167 L21.9384615,7.68628409 L21.9384615,7.41538462 L17.4824105,7.41538462 L14.3059685,15.3391941 L10.6929541,7.41538462 L6.01861668,7.41538462 L6.01861668,7.68628409 L7.52403936,9.49980554 C7.67182769,9.63301305 7.74730311,9.82863473 7.72727142,10.0265545 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/josiahparry" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    
</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="/js/main.min.c1aee25a817e9beb1f9c4afd9d62311227a7f5e46720e404dc1dda97281f47f2.js" integrity="sha256-wa7iWoF+m+sfnEr9nWIxEien9eRnIOQE3B3alygfR/I="></script>
</footer>
    </body>
</html>