<!DOCTYPE html>

<html lang="en-us">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="format-detection" content="telephone=no"/>

    <title>Josiah Parry</title>
    
    
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3DB4">
    <meta name="theme-color" content="#ffffff">

    
    
    
    <link rel="stylesheet" href="/css/main.min.d3bf53b36f3c9a16e5cdae3b1e9f6320cf7e1833357c47d8a780ef4d7069c3bc.css"/>

    
    
    

    
    
 
    
    
    
    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WZD2QXY3QW"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WZD2QXY3QW');
</script>
</head>
    <body>
        
<nav>
  <header>
    <div class="site-title">
        <a href="/">Josiah Parry</a>
    </div>
      
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/atelier-estuary-light.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</header>
  <div class="nav-menu">
  
    <a class="color-link nav-link" href="/about/">about</a>
  
    <a class="color-link nav-link" href="/">posts</a>
  
    <a class="color-link nav-link" href="/projects/">projects</a>
  
    <a class="color-link nav-link" href="/tags/">tags</a>
  
    <a class="color-link nav-link" href="/archives/">archives</a>
  
  <a class="color-link nav-link" href="/index.xml" target="_blank" rel="noopener" type="application/rss+xml">RSS</a>
</div>
<footer class="footer">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="https://twitter.com/@josiahparry" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://linkedin.com/in/josiahparry" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://medium.com/@JosiahParry/" target="_blank" rel="noopener" title="Medium">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,2 L26,2 L26,26 L2,26 L2,2 Z M7.72727142,10.0265545 L7.72727142,17.1527156 C7.77112416,17.4097828 7.69008764,17.6723786 7.50898513,17.8600642 L5.81538462,19.9143852 L5.81538462,20.1852847 L10.617683,20.1852847 L10.617683,19.9143852 L8.92408245,17.8600642 C8.74165168,17.6726892 8.65559727,17.4118239 8.69074193,17.1527156 L8.69074193,10.9897526 L12.9059255,20.1852847 L13.3951878,20.1852847 L17.0157294,10.9897526 L17.0157294,18.3190884 C17.0157294,18.514738 17.0157294,18.5523628 16.8877685,18.6802876 L15.5855778,19.9444852 L15.5855778,20.2153846 L21.9083531,20.2153846 L21.9083531,19.9444852 L20.6513252,18.7103876 C20.5403599,18.6258033 20.4853154,18.4867833 20.50831,18.3491883 L20.50831,9.28158097 C20.4853154,9.14398599 20.5403599,9.00496587 20.6513252,8.92038167 L21.9384615,7.68628409 L21.9384615,7.41538462 L17.4824105,7.41538462 L14.3059685,15.3391941 L10.6929541,7.41538462 L6.01861668,7.41538462 L6.01861668,7.68628409 L7.52403936,9.49980554 C7.67182769,9.63301305 7.74730311,9.82863473 7.72727142,10.0265545 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/josiahparry" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    
</div>




 
	
	<script src="/js/main.min.c1aee25a817e9beb1f9c4afd9d62311227a7f5e46720e404dc1dda97281f47f2.js" integrity="sha256-wa7iWoF+m+sfnEr9nWIxEien9eRnIOQE3B3alygfR/I="></script>
</footer>
</nav>
        <div id="content" class="content-container">
        

<h1 class="post-title">genius Plumber API</h1>
    
    <time>March 30, 2019</time>
    
    <div>
        <p>
        


<p><em>get started <a href="https://github.com/JosiahParry/genius-api">here</a></em></p>
<p>Since I created <code>genius</code>, I’ve wanted to make a version for python. But frankly, that’s a daunting task for me seeing as my python skills are intermediate at best. But recently I’ve been made aware of the package <code>plumber</code>. To put it plainly, <code>plumber</code> takes your R code and makes it accessible via an API.</p>
<p>I thought this would be difficult. I was so wrong.</p>
<p><img src="https://media.giphy.com/media/l0MYOMxG9ijrXhF3q/giphy.gif" /></p>
<div id="using-plumber" class="section level2">
<h2>Using plumber</h2>
<p>Plumber works by using <code>roxygen</code> like comments (<code>#*</code>). Using a single comment, you can define the request type and the end point. Following that you define a function. The arguments to the funciton become the query parameters.</p>
<p>The main <code>genius</code> functions only require two main arguments <code>artist</code> and <code>album</code> or <code>song</code>. Making these accessible by API is as simple as:</p>
<pre><code>#* @get /track
function(artist, song) {
  genius::genius_lyrics(artist, song)
}</code></pre>
<p>With this line of code I created an endpoint called <code>track</code> to retrieve song lyrics. The two parameters as defined by the anonymous function are <code>artist</code> and <code>song</code>. This means that song lyrics are accessible with a query looking like <code>http://hostname/track?artist=artist_name&amp;song=song_name</code>.</p>
<p>But as it stands, this isn’t enough to host the API locally. Save your functions with plumber documentation into a file (I named mine <code>plumber.R</code>).</p>
<div id="creating-the-api" class="section level3">
<h3>Creating the API</h3>
<p>Creating the API is probably the easiest part. It takes quite literally, two lines of code. The function <code>plumb()</code> takes two arguments, the <code>file</code> which contains your plumber commented code, and the <code>dir</code>ectory that houses it.</p>
<p><code>plumb()</code> creates a router which is “responsible for taking an incoming request, submitting it through the appropriate filters.”</p>
<p>I created a plumber router which would be used to route income queries.</p>
<pre><code>pr &lt;- plumb(&quot;plumber.R&quot;)</code></pre>
<p>The next step is to actually run the router. Again, this is quite simple by calling the <code>run()</code> method of the <code>pr</code> object. All I need to do is specify the <code>port</code> that the API will listen on, and optionally the <code>host</code> address.</p>
<pre><code>pr$run(port = 80, host = &quot;0.0.0.0&quot;)</code></pre>
<p>Now I can construct queries in my browser. An example query is <code>http://localhost/track?artist=andrew%20bird&amp;song=proxy%20war</code>. Sending this request produces a very friendly <code>json</code> output.</p>
<pre><code>[
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:1,&quot;lyric&quot;:&quot;He don&#39;t have to get over her&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:2,&quot;lyric&quot;:&quot;She don&#39;t to have get over him&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:3,&quot;lyric&quot;:&quot;With all their words preserved forevermore&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:4,&quot;lyric&quot;:&quot;You don&#39;t have to get over her&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:5,&quot;lyric&quot;:&quot;She don&#39;t have to get over you&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:6,&quot;lyric&quot;:&quot;It&#39;s true these two have never met before&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:7,&quot;lyric&quot;:&quot;At least not in real life&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:8,&quot;lyric&quot;:&quot;Where your words cut like a knife&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:9,&quot;lyric&quot;:&quot;Conjuring blood, biblical floods&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:10,&quot;lyric&quot;:&quot;Looks that stop time&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:11,&quot;lyric&quot;:&quot;You don&#39;t have to remember&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:12,&quot;lyric&quot;:&quot;We forget what memories are for&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:13,&quot;lyric&quot;:&quot;Now we store them in the atmosphere&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:14,&quot;lyric&quot;:&quot;If you don&#39;t want to get too close&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:15,&quot;lyric&quot;:&quot;You don&#39;t have to get too close&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:16,&quot;lyric&quot;:&quot;It&#39;s just what we&#39;re calling peer-to-peer&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:17,&quot;lyric&quot;:&quot;You don&#39;t want to get over&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:18,&quot;lyric&quot;:&quot;You don&#39;t have to get over&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:19,&quot;lyric&quot;:&quot;We store them in the atmosphere&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:20,&quot;lyric&quot;:&quot;If you don&#39;t want to get over her&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:21,&quot;lyric&quot;:&quot;She don&#39;t have to get over you&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:22,&quot;lyric&quot;:&quot;It&#39;s true these two have never met before&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:23,&quot;lyric&quot;:&quot;At least not in real life&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:24,&quot;lyric&quot;:&quot;Where your words cut like a knife&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:25,&quot;lyric&quot;:&quot;Conjuring blood, biblical floods&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:26,&quot;lyric&quot;:&quot;Looks that stop time&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:27,&quot;lyric&quot;:&quot;If you don&#39;t want to get over her&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:28,&quot;lyric&quot;:&quot;You don&#39;t have to get over her&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:29,&quot;lyric&quot;:&quot;If you don&#39;t want to get too close&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:30,&quot;lyric&quot;:&quot;You don&#39;t have to get too close&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:31,&quot;lyric&quot;:&quot;If you want to remember&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:32,&quot;lyric&quot;:&quot;If you don&#39;t want to get over&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:33,&quot;lyric&quot;:&quot;If you don&#39;t want to get over&quot;},
{&quot;track_title&quot;:&quot;Proxy War&quot;,&quot;line&quot;:34,&quot;lyric&quot;:&quot;If you don&#39;t want to get over&quot;}
]</code></pre>
</div>
</div>
<div id="writing-a-python-wrapper" class="section level2">
<h2>Writing a Python Wrapper</h2>
<p>One of the appeals of writing an API is that it can be accessed from any language. This was the inspiriation of creating this API. I want to be able to call R using Python. Creating an API is a great intermediary as writing an API wrapper is much easier for me than recreating all of the code that I wrote in R.</p>
<p>I want to be able to recreate the three main functions of <code>genius</code>. These are <code>genius_lyrics()</code>, <code>genius_album()</code>, and <code>genius_tracklist()</code>. In doing this there are two steps I have to consider. The first is creating query urls, and the second is parsing json.</p>
<p>To create the urls, the <code>requests</code> library is used. Next, I created a template for the urls.</p>
<pre><code>import requests
url_template = &quot;http://localhost:80/track?artist={}&amp;song={}&quot;</code></pre>
<p>The idea here is that the <code>{}</code> characters will be filled with provided parameters by using the <code>.format()</code> method.</p>
<p>For example, if I wanted to get lyrics for Proxy War by Andrew Bird, I would supply <code>&quot;Andrew Bird&quot;</code> and <code>&quot;Proxy War&quot;</code> as the arguments to <code>format()</code>. It’s important to note that these arguments are taken positionally. The url is created using this method.</p>
<pre><code>url = url_template.format(&quot;andrew bird&quot;, &quot;proxy war&quot;)</code></pre>
<p>Now I am at the point where I can ping the server to receive the json. This is accomplished by using the <code>.get()</code> method from <code>requests</code>.</p>
<pre><code>response = requests.get(url)</code></pre>
<p>This returns an object that contains the json response. Next, in order to get this into a format that can be analysed, it needs to be parsed. I prefer a Pandas <code>DataFrame</code>, and fortunately Pandas has a lovely <code>read_json</code> function. I will call the <code>.content</code> attribute of the <code>response</code> objectm and feed that into the <code>read_json()</code> function.</p>
<pre><code>import pandas as pd

proxy_war = pd.read_json(response.content)

proxy_war.head()

    line    lyric                                   track_title
0   1   He don&#39;t have to get over her               Proxy War
1   2   She don&#39;t to have get over him              Proxy War
2   3   With all their words preserved forevermore  Proxy War
3   4   You don&#39;t have to get over her              Proxy War
4   5   She don&#39;t have to get over you              Proxy War</code></pre>
<p>Beautiful. Song lyrics are available through this API and can easily be accessed via python. The next step is to generalize this and the other two functions. The below is the code to create the <code>genius_lyrics()</code> function in python. It works almost identically as in R. However, at this moment it does not have the ability to set the <code>info</code> argument. But this can be changed easily in the original <code>plumber.R</code> file.</p>
<pre><code># Define genius_lyrics()
def genius_lyrics(artist, song):

    url_template = &quot;http://localhost:80/track?artist={}&amp;song={}&quot;
    
    url = url_template.format(artist, song)

    response = requests.get(url)
    
    song = pd.read_json(response.content)
    
    return(song)</code></pre>
<p>At this point I’m feeling extremely stoked on the fact that I can use <code>genius</code> with python. Who says R and python practitioners can’t work together?</p>
<p><img src="https://media.giphy.com/media/l2JJyDYEX1tXFmCd2/giphy.gif" /></p>
</div>
<div id="containerize-with-docker" class="section level2">
<h2>Containerize with Docker</h2>
<p><img src="https://media.giphy.com/media/cUMNWzWZ5n75LvcCIe/giphy.gif" /></p>
<p>To make the process of setting up this genius API up easier for those who don’t necessarily interact with R, I created a lightweight-ish Docker container. The idea for this was to be able to pull a Docker image, run a command, and then the API will be available on a local port without having to interact with R at all.</p>
<p>I’m not the most experience person with creating Docker containers but I can borrow code quite well. Fortunately I came across some wonderful <a href="https://nolisllc.com/assets/presentations/r-tensorflow-api.pdf">slides</a> from <code>rstudio::conf 2019</code>. <a href="https://twitter.com/heatherklus">Heather Nollis</a> and <a href="https://twitter.com/skyetetra">Jacqueline Nolis</a> presented on “API development with R and TensorFlow at T-Mobile”.</p>
<p>This container needs two things: a linux environment and an installation of R with plumber, genius, and its dependencies. An organization called <a href="https://www.rocker-project.org/">The Rocker Project</a> has created a number of Docker images that are stable and easy to install.</p>
<p>Since <code>genius</code> relies on many packages from the <a href="https://tidyverse.org">tidyverse</a>, the <a href="https://hub.docker.com/r/rocker/tidyverse"><code>rocker/tidyverse</code></a> image was used. To use their wonderful image, only one line is needed in my <code>Dockerfile</code>.</p>
<pre><code># Import existing Docker image
FROM rocker/tidyverse:3.5.2</code></pre>
<p>Now, not knowing exactly what I was doing, I copied code from Jacqueline and Heather’s sample <code>Dockerfile</code> in their slides. Their comment says that this is necessary to have the <em>“needed linux libraries for plumber”</em>, I went with it.</p>
<pre><code># install needed linux libraries for plumber
RUN apt-get update -qq &amp;&amp; apt-get install -y \
  libssl-dev \
  libcurl4-gnutls-dev</code></pre>
<p><code>genius</code> and <code>plumber</code> are not part of the tidyverse image and have to be installed manually. The following lines tell Docker to run the listed R commands. For some unknown reason there was an issue with installing <code>genius</code> from CRAN so the <code>repos</code> argument was stated explicitly.</p>
<pre><code># Install R packages
RUN R -e &quot;install.packages(&#39;genius&#39;, repos = &#39;http://cran.rstudio.com/&#39;)&quot;
RUN R -e &quot;install.packages(&#39;plumber&#39;)&quot;</code></pre>
<p>In addition to the <code>Dockerfile</code> there are two files in my directory which are used to launch the API. The <code>plumber.R</code> and <code>launch_api.R</code> files. These need to be copied into the container. The line <code>COPY / /</code> copies from the location <code>/</code> in my directory to the location <code>/</code> in the container.</p>
<p>The Docker image has the libraries and files needed, but it needs to be able to actually launch the API. Since the <code>plumber.R</code> file specifies that the API will be listening on port <code>80</code>, I need to expose that port in my Docker image using <code>EXPOSE 80</code>.</p>
<p>The last part of this is to run the <code>launch_api.R</code> so the API is available. The <code>ENTRYPOINT</code> command tells Docker what to run when the container is launched. In this case <code>ENTRYPOINT [&quot;Rscript&quot;, &quot;launch_api.R&quot;]</code> tells Docker to run the <code>Rscript</code> command with the argument <code>launch_api.R</code>. And with that, the <code>Dockerfile</code> is complete and read to run.</p>
<p>The image needs to be built and ran. The simplest way to do this for me was to work from <a href="https://cloud.docker.com/repository/docker/josiahparry/genius-api">Dockerhub</a>. Thus to run this container only three lines of code are needed!</p>
<pre><code>docker pull josiahparry/genius-api:working

docker build -t josiahparry/genius-api .

docker run --rm -p 80:80 josiahparry/genius-api</code></pre>
<p><img src="https://media.giphy.com/media/3o7qDEq2bMbcbPRQ2c/giphy.gif" /></p>
<p>Boom, now you have an API that will be able to use the functionality of <code>genius</code>. If you wish to use Python with the API, I wrote a simple script which creates a nice tidy <a href="https://github.com/JosiahParry/genius-api/blob/master/genius.py">wrapper</a> around it.</p>
<hr />
<p>If anyone is interested in writing a more stable Python library that can call the functionality described above I’d love your help to make <code>genius</code> more readily available to the python community.</p>
</div>

        </p>
    </div>
    
    

    

    <div class="page-footer">
        
        <hr class="footer-divider">
        
            <a class="tag" href="/tags/docker">#Docker</a>
        
            <a class="tag" href="/tags/python">#Python</a>
        
            <a class="tag" href="/tags/r">#R</a>
        
            <a class="tag" href="/tags/genius">#genius</a>
        
            <a class="tag" href="/tags/plumber">#plumber</a>
        
            <a class="tag" href="/tags/api">#api</a>
        
            <a class="tag" href="/tags/tutorial">#tutorial</a>
        
      
    </div>
    



        




<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>

        </div>
        <footer class="footer-mobile">
	<div class="social-icons">
        

    

    
    <a class="social-icon" href="https://twitter.com/@josiahparry" target="_blank" rel="noopener" title="Twitter">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M8.991284,24.971612 C19.180436,24.971612 24.752372,16.530224 24.752372,9.210524 C24.752372,8.970656 24.747512,8.731868 24.736496,8.494376 C25.818008,7.712564 26.758256,6.737 27.5,5.62622 C26.507372,6.067076 25.439252,6.364292 24.318752,6.498212 C25.462472,5.812628 26.340512,4.727444 26.754584,3.434036 C25.684088,4.068536 24.499004,4.53002 23.23724,4.778528 C22.226468,3.701876 20.786828,3.028388 19.193828,3.028388 C16.134404,3.028388 13.653536,5.509256 13.653536,8.567492 C13.653536,9.0023 13.702244,9.424904 13.797176,9.830552 C9.19346,9.599108 5.11106,7.39472 2.3792,4.04294 C1.903028,4.861364 1.629032,5.812628 1.629032,6.827072 C1.629032,8.74904 2.606972,10.445612 4.094024,11.438132 C3.185528,11.41016 2.331788,11.160464 1.585184,10.745096 C1.583888,10.768208 1.583888,10.791428 1.583888,10.815728 C1.583888,13.49888 3.493652,15.738584 6.028088,16.246508 C5.562932,16.373084 5.07326,16.44134 4.56782,16.44134 C4.210988,16.44134 3.863876,16.406024 3.526484,16.34144 C4.231724,18.542264 6.276596,20.143796 8.701412,20.18894 C6.805148,21.674696 4.416836,22.56008 1.821488,22.56008 C1.374476,22.56008 0.93362,22.534592 0.5,22.4834 C2.951708,24.054476 5.862524,24.971612 8.991284,24.971612"></path>
        </svg>
    </a>
    

    

    

    

    

    

    

    

    
    <a class="social-icon" href="https://linkedin.com/in/josiahparry" target="_blank" rel="noopener" title="LinkedIn">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,3.654102 C2,2.69908141 2.79442509,1.92397846 3.77383592,1.92397846 L24.2261641,1.92397846 C25.2058917,1.92397846 26,2.69908141 26,3.654102 L26,24.3462148 C26,25.3015521 25.2058917,26.0760215 24.2261641,26.0760215 L3.77383592,26.0760215 C2.79442509,26.0760215 2,25.3015521 2,24.3465315 L2,3.65378524 L2,3.654102 Z M9.27526132,22.1415901 L9.27526132,11.2356668 L5.65030092,11.2356668 L5.65030092,22.1415901 L9.27557808,22.1415901 L9.27526132,22.1415901 Z M7.46341463,9.74691162 C8.72727273,9.74691162 9.51409566,8.90940767 9.51409566,7.86284447 C9.49033893,6.79252455 8.72727273,5.97846056 7.48748812,5.97846056 C6.24675325,5.97846056 5.43649034,6.79252455 5.43649034,7.86284447 C5.43649034,8.90940767 6.22299652,9.74691162 7.4396579,9.74691162 L7.46309788,9.74691162 L7.46341463,9.74691162 Z M11.2815965,22.1415901 L14.9062401,22.1415901 L14.9062401,16.0519481 C14.9062401,15.7263225 14.9299968,15.4000634 15.0256573,15.1675641 C15.2876148,14.5159962 15.8840672,13.8416218 16.8856509,13.8416218 C18.1970225,13.8416218 18.7218879,14.8416218 18.7218879,16.3078872 L18.7218879,22.1415901 L22.3465315,22.1415901 L22.3465315,15.8885017 C22.3465315,12.5388027 20.5584416,10.9800443 18.1735825,10.9800443 C16.2182452,10.9800443 15.3595185,12.072854 14.8824834,12.8172315 L14.9065569,12.8172315 L14.9065569,11.2359835 L11.2819132,11.2359835 C11.3291099,12.2591067 11.2815965,22.1419069 11.2815965,22.1419069 L11.2815965,22.1415901 Z"></path>
        </svg>
    </a>
    

    
    <a class="social-icon" href="https://medium.com/@JosiahParry/" target="_blank" rel="noopener" title="Medium">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M2,2 L26,2 L26,26 L2,26 L2,2 Z M7.72727142,10.0265545 L7.72727142,17.1527156 C7.77112416,17.4097828 7.69008764,17.6723786 7.50898513,17.8600642 L5.81538462,19.9143852 L5.81538462,20.1852847 L10.617683,20.1852847 L10.617683,19.9143852 L8.92408245,17.8600642 C8.74165168,17.6726892 8.65559727,17.4118239 8.69074193,17.1527156 L8.69074193,10.9897526 L12.9059255,20.1852847 L13.3951878,20.1852847 L17.0157294,10.9897526 L17.0157294,18.3190884 C17.0157294,18.514738 17.0157294,18.5523628 16.8877685,18.6802876 L15.5855778,19.9444852 L15.5855778,20.2153846 L21.9083531,20.2153846 L21.9083531,19.9444852 L20.6513252,18.7103876 C20.5403599,18.6258033 20.4853154,18.4867833 20.50831,18.3491883 L20.50831,9.28158097 C20.4853154,9.14398599 20.5403599,9.00496587 20.6513252,8.92038167 L21.9384615,7.68628409 L21.9384615,7.41538462 L17.4824105,7.41538462 L14.3059685,15.3391941 L10.6929541,7.41538462 L6.01861668,7.41538462 L6.01861668,7.68628409 L7.52403936,9.49980554 C7.67182769,9.63301305 7.74730311,9.82863473 7.72727142,10.0265545 Z"></path>
        </svg>
    </a>
    

    

    

    

    

    

    
    
    
    <a class="social-icon" href="https://github.com/josiahparry" target="_blank" rel="noopener" title="GitHub">
        <svg width="28px" height="28px" viewBox="0 0 28 28" version="1.1" fill="#ABABAB" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path d="M13.9988029,1.32087331 C6.82105037,1.32087331 1,7.14112562 1,14.3212723 C1,20.0649109 4.72454649,24.9370678 9.89038951,26.6560892 C10.5408085,26.7757983 10.7778323,26.374374 10.7778323,26.0296121 C10.7778323,25.7215609 10.7666595,24.9035493 10.760275,23.8189856 C7.14426471,24.6042767 6.38131925,22.0760223 6.38131925,22.0760223 C5.78995672,20.5740732 4.93762853,20.1742451 4.93762853,20.1742451 C3.75729765,19.3682044 5.02701126,19.3841656 5.02701126,19.3841656 C6.33183953,19.4759425 7.01817121,20.7241085 7.01817121,20.7241085 C8.17775254,22.7104801 10.0611744,22.1366749 10.8017741,21.8038838 C10.919887,20.9643246 11.2558703,20.3913175 11.6269683,20.066507 C8.74038491,19.7385043 5.70536235,18.6228163 5.70536235,13.6413251 C5.70536235,12.2223743 6.21213051,11.0611968 7.04370914,10.1530044 C6.90963504,9.82420367 6.46351945,8.50181809 7.17139875,6.71256734 C7.17139875,6.71256734 8.26234691,6.36301702 10.7459099,8.04532771 C11.78259,7.75642995 12.8950858,7.61277914 14.000399,7.60719272 C15.1049142,7.61277914 16.2166119,7.75642995 17.2548881,8.04532771 C19.736855,6.36301702 20.8262071,6.71256734 20.8262071,6.71256734 C21.5356825,8.50181809 21.0895669,9.82420367 20.9562909,10.1530044 C21.7894656,11.0611968 22.2922435,12.2223743 22.2922435,13.6413251 C22.2922435,18.6355852 19.2524325,19.734514 16.3570705,20.0561322 C16.8231376,20.4575564 17.2389269,21.2508282 17.2389269,22.4638795 C17.2389269,24.2012564 17.2229657,25.603448 17.2229657,26.0296121 C17.2229657,26.3775663 17.4575954,26.7821827 18.116793,26.6552912 C23.2786458,24.9322794 27,20.0633148 27,14.3212723 C27,7.14112562 21.1789496,1.32087331 13.9988029,1.32087331"></path>
        </svg>
    </a>
    

    
    
    

    
</div>




	<div class="footer-mobile-links">
		<p><a href="https://github.com/kimcc/hugo-theme-noteworthy" target="_blank" rel="noopener">Noteworthy theme</a></p>
		<span class="divider-bar">|</span>
		<p><a href="https://gohugo.io" target="_blank" rel="noopener">Built with Hugo</a></p>
	</div>

	<script src="/js/main.min.c1aee25a817e9beb1f9c4afd9d62311227a7f5e46720e404dc1dda97281f47f2.js" integrity="sha256-wa7iWoF+m+sfnEr9nWIxEien9eRnIOQE3B3alygfR/I="></script>
</footer>
    </body>
</html>